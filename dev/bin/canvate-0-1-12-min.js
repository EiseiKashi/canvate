window.Canvate=function(t){"use strict";if("string"==typeof t&&null==(t=document.getElementById(t)))throw"There is no element with the 'id': "+t;window.check=!0;for(var i=0,e=["ms","moz","webkit","o"],n=0;n<e.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[e[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[n]+"CancelAnimationFrame"]||window[e[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,e){var n=Date.now(),a=Math.max(0,16-(n-i)),s=window.setTimeout(function(){t(n+a)},a);return i=n+a,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)});var a,s,h,l,o,r,u,c,m,f,d,g,w,v,p="mouseOver",M="mouseOut",x="mouseUp",E="mouseDown",N="click",C="function",T="canvas",A="2d",y="image/png",I="Anonymous",D="source-over",R="destination-in",L="play",S="playFrom",b="playUntil",Y="playBetween",k=function(t){var i,e,n=0,a=0,s=0,h=0,l=0,o=!1,r=t,u={};this.addEventListener=function(t,e,r){if(null!=t&&""!=t&&typeof e===C){null==(i=u[t])&&(i=u[t]=[]);for(var c=i.length,m=0;m<c;m++)if(e[1]==e&&e[0]==r)return;switch(u[t].push([r,e]),t){case N:n++;break;case p:a++;break;case M:s++;break;case E:h++;break;case x:l++}return o=n+a+s+h+l>0,!0}},this.removeEventListener=function(t,e,r){if(null!=t&&""!=t&&typeof e===C&&null!=(i=u[t]))for(var c=i.length,m=0;m<c;m++)if((e=i[m])[1]==e&&e[0]==r){switch(u[t].splice(m,1),t){case N:n--;break;case p:a--;break;case M:s--;break;case E:h--;break;case x:l--}return o=n+a+s+h+l>0,!0}},this.emit=function(t,n){if(null!=t&&""!=t&&null!=(i=u[t])){(n=null==n||"object"!=typeof n?{}:n).type=t,n.target=r;for(var a=i.length,s=0;s<a;s++)(e=i[s])[1].apply(e[0],[n])}},this.hasMouse=function(){return o}},_=function(t,i,e,n,a,s,h){var l,o,r,u,c,m,f,d,g,w,v,p,M,x,E,N,C,T,A,y,I,D,R,L;return n-i,a-e,C=(f=n*(c=Math.cos(t)))-(d=a*(m=Math.sin(t)))+i,T=(g=n*m)+(w=a*c)+e,A=(M=(v=n+s)*c)-d+i,y=(x=v*m)+w+e,I=M-(E=(p=a+h)*m)+i,D=x+(N=p*c)+e,R=f-E+i,L=g+N+e,{minX:l=Math.min(Math.min(C,A),Math.min(I,R)),minY:o=Math.min(Math.min(T,y),Math.min(D,L)),maxX:r=Math.max(Math.max(C,A),Math.max(I,R)),maxY:u=Math.max(Math.max(T,y),Math.max(D,L)),width:Math.abs(r-l),height:Math.abs(u-o)}},B=0,F={},O={},X={},z={mask:R,slice:"destination-out"},P=function(t){var i=this;this.TEXT_SET="textSet",this.IMAGE_SET="imageSet",this.IMAGE_LOADED="imageLoaded",this.IMAGE_ERROR="imageError",this.CLIP_ADDED="clipAdded",this.CLIP_REMOVED="clipRemoved",this.CYCLE_END="cycleEnd",this.CYCLE_START="cycleStart",this.RENDER="render",this.START="start",this.END="end",this.CENTER="center",this.LEFT="left",this.RIGHT="right",this.TOP="top",this.BOTTOM="bottom",this.MIDDLE="middle";var e="clip"+ ++B;O[e]=this,this.name=e,this.x=0,this.y=0,this.width=0,this.height=0,this.alpha=1,this.scaleX=1,this.scaleY=1,this.rotation=0,this.pivotX=0,this.pivotY=0,this.visible=!0,this.isLoop=!1,this.background=null,this.text,this.interline=1.313,this.fontSize=12,this.font="sans-serif",this.textAlign=this.START,this.textBaseline="top",this.fontColor="black";var n,s,h,l,o,r,u,c,m,f,d,g,w,v,p,M,x,E,N,C,q,G,U,W,H,V,j,J,K,Q,Z,$,tt,it,et,nt,at,st,ht,lt="auto",ot=0,rt=0,ut=60,ct=1,mt=0,ft=0,dt=0,gt=0,wt=new k(this),vt=document.createElement(T),pt=vt.getContext(A),Mt=[],xt=[],Et=null,Nt=null;this.setPosition=function(t,i){!(null==t||isNaN(t))&&(this.x=t),!(null==i||isNaN(i))&&(this.y=i)},this.setSize=function(t,i){var e=null==t||isNaN(t)&&t!=lt,n=null==i||isNaN(i)&&i!=lt;e||n||t==lt&&i==lt||(null==Et&&null==Nt||(t==lt&&(t=i/Nt*Et),i==lt&&(i=t/Et*Nt)),this.width=t,this.height=i)},this.setScale=function(t,i){!(null==t||isNaN(t))&&(this.scaleX=t),!(null==i||isNaN(i))&&(this.scaleY=i)},this.setPivot=function(t,i){!(null==t||isNaN(t))&&(this.pivotX=t),!(null==i||isNaN(i))&&(this.pivotY=i)},this.fitInto=function(t,i,e,n){if(null!=t&&null!=i&&!isNaN(t)&&!isNaN(i)){(null==e||isNaN(e))&&(e=0),(null==n||isNaN(n))&&(n=0);var a=Math.min(t/Et,i/Nt),s=Et*a,h=Nt*a;this.setSize(Math.floor(s),lt);var l=Math.floor((t-s)/2),o=Math.floor((i-h)/2);this.x=l+this.pivotX*s+e,this.y=o+this.pivotY*h+n}},this.setAutoWidth=function(){this.setSize(lt,this.height)},this.setAutoHeight=function(){this.setSize(this.width,lt)},this.crop=function(t,e,a,s,h,l){t=null==t?mt:t,e=null==e?ft:e,a=null==a?dt:a,s=null==s?gt:s;i.width=null,i.height=null,dt=null,gt=null;var o=document.createElement(T);o.width=a,o.height=s,h=null==h||isNaN(h)?a:h,l=null==l||isNaN(l)?s:l,o.getContext(A).drawImage(n,t,e,a,s,0,0,h,l);var r=document.createElement("img");r.crossOrigin=I,r.src=o.toDataURL(y),this.setImage(o),this.setSize(h,l)},this.setImage=function(t){null!=t&&((n=t).crossOrigin=I,Et=t.width,Nt=t.height,this.width=null==this.width||0==this.width?Et:this.width,this.height=null==this.height||0==this.height?Nt:this.height,(s=document.createElement(T)).width=this.width,s.height=this.height,(h=s.getContext(A)).drawImage(t,0,0,Et,Nt),this.setSize(this.width,this.height),dt=null==dt||0==dt?Et:dt,gt=null==gt||0==gt?Nt:gt,this.setCycle(mt,ft,dt,gt),At(i.IMAGE_SET,{image:t}))},this.setImageById=function(t){var i=document.getElementById(t);if(i.crossOrigin=I,null==i)throw"There is no element with the id: "+t;return setImage(i),i},this.loadImage=function(t,e){var n=new Image;n.onload=function(){i.setImage(n),At(i.IMAGE_LOADED,{image:n,src:t})},n.onerror=function(e){At(i.IMAGE_ERROR,{src:t})};var a=e?"?"+(new Date).getTime():"";n.crossOrigin=I,n.src=t+a},this.setMask=function(t,i){null!=t&&(X[t.getId()]=this,_typeMask=z[i]||z.mask,l=t)},this.removeMask=function(){_typeMask=D,null!=l&&(X[l.getId()]=null,l=null)},this.isMask=function(){return X[e]},this.setBackground=function(t){this.background=t},this.setRect=function(t,e,n){if(null!=t&&null!=e&&!isNaN(t)&&!isNaN(e)){i.width=null,i.height=null,dt=null,gt=null;var a=document.createElement(T);a.width=t,a.height=e;var s=a.getContext(A);s.fillStyle=n,s.fillRect(0,0,t,e);var h=document.createElement("img");h.crossOrigin=I,h.src=a.toDataURL(y),this.setImage(a)}},this.setText=function(t,e,n,a){this.text=t,this.fontSize=null==e?this.fontSize:12,this.font=null==n?this.font:n,this.fontColor=null==a?this.fontColor:a,At(i.TEXT_SET,{text:this.text})},this.getId=function(){return e},this.getNewClip=function(t){return new P(t)},this.addNewClip=function(t){var i=new P(t);return this.addClip(i),i},this.getClipAt=function(t){return Mt[t]},this.addClip=function(t){null!=t&&t!=this&&this.addClipAt(t,Mt.length)},this.addClipAt=function(t,e){if(null!=t&&t!=this&&!isNaN(e)){var n=t.getParent();null!=n&&n.removeClip(t),Mt.splice(e,0,t),F[t.getId()]=this,At(i.CLIP_ADDED,{parent:n})}},this.removeClip=function(t){if(null!=t&&t!=this)for(var i=Mt.length,e=0;e<i;e++)if(Mt[e]==t)return this.removeClipAt(e)},this.removeClipAt=function(t){if(!isNaN(t||t<0||!(t<Mt.length))){var e=Mt.splice(t,1)[0],n=F[e.getId()];return F[e.getId()]=null,At(i.CLIP_REMOVED,{parent:n}),e}},this.removeAllClips=function(){for(;Mt.length>0;)this.removeClipAt(0)},this.getTotalClip=function(){return Mt.length},this.setDepth=function(t,i){if(null!=t&&t!=this&&!isNaN(i)){i=Math.max(i,0);for(var e=Mt.length,n=0;n<e;n++)Mt[n]==t&&Mt.splice(i,0,Mt.splice(n,1)[0])}},this.swapClips=function(t,i){if(null!=t&&null!=i){for(var e,n,a,s=Mt.length;--s>-1;)t==(a=Mt[s])&&(e=s),i==a&&(n=s);if(null!=e&&null!=n){var h=Mt[e],l=Mt[n];Mt[e]=l,Mt[n]=h}}},this.toFront=function(t){null!=t&&this.setDepth(t,Mt.length-1)},this.toBack=function(t){null!=t&&this.setDepth(t,0)},this.getParent=function(){return F[e]},this.getClipByProp=function(t,i){return getClipListByProp(t,i)[0]},this.getClipListByProp=function(t,i){for(var e=Mt.length,n=[],a=0;a<e;a++){var s;(s=Mt[a])[t]==i&&n.push[s]}return n},this.setCycle=function(t,i,e,a,l,o,r){if(w=mt=null==t||isNaN(t)?mt:t,v=ft=null==i||isNaN(i)?ft:i,p=dt=null==e||isNaN(e)?dt:e,M=gt=null==a||isNaN(a)?gt:a,o=null==o||isNaN(o)?0:o,r=null==r||isNaN(r)?0:r,null==l||isNaN(l)){var u=Math.floor(n.width/p),c=Math.floor(n.height/M);l=ct=u*c}var m;for(0==ct&&(ct=1),(s=document.createElement(T)).width=p*ct,s.height=M,h=s.getContext(A),xt.length=0,x=0;x<ct;x++)if(m=p*x,xt.push({x:m,y:0,width:p,height:M}),h.drawImage(n,w,v,p,M,m,0,p,M),(w+=p)>=Et&&(w=0,v+=M,ft>Nt))throw new Error("The total frames is out of bound");1<ct&&this.setSize(p,lt)};var Ct=function(t){ot=rt>=t?-1:1,m=t},Tt=function(t){if(isNaN(t))throw new Error("The frame must be an integer and is: "+t);return E=(E=(E=t-1)<0?0:E)>=xt.length?xt.length-1:E};this.play=function(){var t=f;d=Date.now(),E=xt.length-1,g=L,c=0,Ct(E),At(i.CYCLE_START,{frame:t,action:g})},this.playFrom=function(t){var e=f;d=Date.now(),E=Tt(t),f=E+1,rt=E,c=E,g=S,Ct(xt.length-1),At(i.CYCLE_START,{frame:e,action:g})},this.playUntil=function(t){var e=f;d=Date.now(),E=Tt(t),c=rt,g=b,Ct(E),At(i.CYCLE_START,{frame:e,action:g})},this.playBetween=function(t,e){var n=f;d=Date.now(),N=Tt(t),C=Tt(e),rt=N,c=N,f=N+1,g=Y,Ct(C),At(i.CYCLE_START,{frame:n,action:g})},this.stop=function(){var t=f;d=Date.now(),f=(E=rt)+1,m=E,g="stop",f=null,g=null,At(i.CYCLE_START,{frame:t,action:g})},this.stopAt=function(t){var e=f;d=Date.now(),E=Tt(t),f=E+1,rt=Math.max(Math.min(E,xt.length),0),m=E,g="stopAt",f=null,g=null,At(i.CYCLE_START,{frame:e,action:g})},this.nextFrame=function(){if(rt>=xt.length-1){if(!this.isLoop)return;rt=0}var t=f;d=Date.now(),E=Math.max(Math.min(rt+1,xt.length),0),f=E+1,rt=E,m=E,g="nextFrame",At(i.CYCLE_START,{frame:t,action:g})},this.prevFrame=function(){if(0==rt){if(!this.isLoop)return;rt=xt.length-1}var t=f;d=Date.now(),E=Math.max(Math.min(rt-1,xt.length),0),f=E+1,rt=E,m=E,g="prevFrame",At(i.CYCLE_START,{frame:t,action:g})},this.getTotalFrames=function(){return ct},this.getCurrentFrame=function(){return f},this.setFrameRate=function(t){null==t||isNaN(t)||(ut=t)},this.getFrameRate=function(){return ut},this.emitMouseEvent=function(t,e,n){a==this&&At(t,{x:e-i.x,y:n-i.y})},this.hasMouse=function(){return u},this.addEventListener=function(t,i,e){wt.addEventListener(t,i,e),u=wt.hasMouse()},this.removeEventListener=function(t,i,e){wt.removeEventListener(t,i,e),u=wt.hasMouse()},this.hasButton=function(){return _hasButton},this.debug=function(){};var At=function(t,i){wt.emit(t,i)},yt=function(t,i,e){if(t.length>i){var n=t.slice(0,i).lastIndexOf(" "),a=t.slice(0,i).lastIndexOf("-");if((l=Math.max(n,a))>0){var s=t.slice(0,l+(a==l?1:0)),h=t.slice(l+1);return pt.fillText(s,0,e),void yt(h,i,e+=r)}var l;n=t.indexOf("-"),a=t.indexOf(" ");if((l=-1==n||-1==a?Math.max(n,a):Math.min(n,a))>0){s=t.slice(0,l+(a==l?0:1)),h=t.slice(l+1);return pt.fillText(s,0,e),void yt(h,i,e+=r)}}return pt.fillText(t,0,e),t};this.render=function(t,e,n,a,h){if(0==Mt.length&&null==s||0==this.visible||this.isMask()&&!h)return{};G=xt[q=rt];try{mt=G.x,ft=G.y,dt=G.width,gt=G.height}catch(t){this.name}if(f=q+1,(U=Date.now())-d>=1e3/ut)if(d=U,rt!=m)rt+=ot,rt=Math.max(0,rt);else if(0!=ot){if(this.isLoop)switch(g){case Y:case b:case S:rt=c;break;case L:rt=0}else ot=0;null!=g&&At(i.CYCLE_END,{frame:f,action:g})}var w,v,p,M,x;W=this.x,H=this.y,at=this.scaleX,st=this.scaleY,V=this.width*at,j=this.height*st,$=this.pivotX*V*at,tt=this.pivotY*j*st,J=mt,K=ft,Q=dt,Z=gt,nt=this.rotation*Math.PI/180;var E,N,C,T=[];w=null,v=null,p=null,M=null,null!=s&&(w=(x=_(0,W,H,-$,-tt,V,j)).minX,v=x.minY,p=x.maxX,M=x.maxY),null!=s?(E=V/Et,N=j/Nt,E=isNaN(E)?1:E,N=isNaN(N)?1:N):(E=1,N=1),E*=at,N*=st,o=null;var A=W-$,y=H-tt,I=Mt.length;for(q=0;q<I;q++)et=Mt[q],ht=et.render(t,e,n-i.x,a-i.y,!1),null!=(it=ht.inner)&&(C=ht.bounds,T.push({canvas:ht.inner,x:C.minX,y:C.minY}),Boolean(ht.clipMouse)&&(o=ht.clipMouse),null!=w?(w=Math.min((C.minX+A)*E,w),v=Math.min((C.minY+y)*N,v),p=Math.max((C.maxX+A)*E,p),M=Math.max((C.maxY+y)*N,M)):(w=(C.minX+A)*E,v=(C.minY+y)*N,p=(C.maxX+A)*E,M=(C.maxY+y)*N));var k=Math.abs(p-w),B=Math.abs(M-v);w=(x=_(nt,W,H,-(W-w),-(H-v),k,B)).minX,v=x.minY,p=x.maxX,M=x.maxY,vt.width=x.width,vt.height=x.height,pt.save(),pt.globalAlpha=i.alpha;var F,O,X,z,P,lt,ct=at<0?-vt.width:0,wt=st<0?-vt.height:0,Ct=.5+W-w+ct<<0,Tt=.5+H-v+wt<<0;if(pt.translate(Ct,Tt),pt.rotate(nt),at=at<0?-1:1,st=st<0?-1:1,pt.scale(at,st),null!=i.background&&(pt.fillStyle=i.background,pt.fillRect(0,0,vt.width,vt.height)),null!=s?(J=.5+J<<0,K=.5+K<<0,Q=.5+Q<<0,Z=.5+Z<<0,$=.5+$<<0,tt=.5+tt<<0,V=.5+V<<0,j=.5+j<<0,pt.drawImage(s,J,K,Q,Z,-$,-tt,V,j)):(i.width=k,i.height=B,Et=k,Nt=B,Q=k,Z=B),null!=i.text){pt.textAlign=i.textAlign,pt.textBaseline=i.textBaseline,pt.fillStyle=i.fontColor,pt.font=i.fontSize+"px "+i.font;for(var It=i.width,Dt=0,Rt="M";Dt<It;)Dt=Math.round(pt.measureText(Rt).width),Rt+="M";r=i.interline*i.fontSize,yt(i.text,Math.max(Rt.length,1),0)}I=T.length;for(var Lt=0;Lt<I;Lt++)null!=(lt=T[Lt])&&(F=lt.canvas,O=.5+(lt.x-$)*E<<0,X=.5+(lt.y-tt)*N<<0,z=.5+F.width*E<<0,P=.5+F.height*N<<0,pt.drawImage(lt.canvas,O,X,z,P));if(u){var St=pt.getImageData(n-w,a-v,1,1).data;St[3]>0&&(o=i)}null!=(et=l)&&(ht=et.render(t,e,n-w,a-v,!0),null!=(it=ht.inner)&&(O=(C=ht.bounds).minX,X=C.minY,O=.5+(O-$)*E<<0,X=.5+(X-tt)*N<<0,z=.5+it.width*E<<0,P=.5+it.height*N<<0,pt.globalCompositeOperation=R,pt.drawImage(it,O,X,z,P),0==pt.getImageData(n-w,a-v,1,1).data[3]&&(o=null),pt.globalCompositeOperation=D)),pt.restore(),vt.id=i.name;var bt={inner:vt,clipMouse:o,bounds:x,x:w,y:v};return At(i.RENDER,{}),i.debug(vt,i.name),bt},this.setImage(t)},q=t,G=q.getContext(A),U=function(){},W=function(){void 0!=h&&void 0!=l&&(d="default",Boolean(m)&&m.hasMouse()?(d="pointer",m!=c&&(H(),c=m,a=m,m.emitMouseEvent(p),a=null)):H(),q.style.cursor=d)},H=function(t){Boolean(c)&&c.hasMouse()&&(a=c,c.emitMouseEvent(M,h,l),t&&c.emitMouseEvent(x,h,l),c=null,m=null,a=null)},V=function(){m=null,q.width=f.width,q.height=f.height,s.width=f.width,s.height=f.height,w=f.render(q.width,q.height,h,l,!1),g=w.inner,Boolean(g)&&(G.drawImage(g,w.x,w.y),null!=(v=w.clipMouse)&&(m=v)),U(),requestAnimationFrame(V)};return function(){q.width=q.width,q.height=q.height,s=q.cloneNode(),s.getContext(A),s.width=q.width,s.height=q.height,(f=new P).name="canvateStage",f.setImage(q),q.onmousemove=function(t){t.preventDefault(),u=q.getBoundingClientRect(),o=t.clientX,r=t.clientY,h=(o-u.left)*(q.width/u.width),l=(r-u.top)*(q.width/u.width),U=W},q.onclick=function(t){t.preventDefault(),Boolean(m)&&m.hasMouse()&&(a=m,m.emitMouseEvent(N,h,l),a=null)},q.onmousedown=function(t){t.preventDefault(),Boolean(m)&&m.hasMouse()&&(a=m,m.emitMouseEvent(E,h,l),a=null)},q.onmouseup=function(t){t.preventDefault(),Boolean(m)&&m.hasMouse()&&(a=m,m.emitMouseEvent(x,h,l),a=null)},window.onmouseleave=function(t){console.log("WINDOW LEFT!!")},document.onmouseleave=q.onmouseleave=function(t){H(!0),U=function(){}};new k(q);V()}(),f};