window.Canvate=function(t){"use strict";if("string"==typeof t&&null==(t=document.getElementById(t)))throw"There is no element with the 'id': "+t;window.check=!0;for(var i=0,e=["ms","moz","webkit","o"],n=0;n<e.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[e[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[n]+"CancelAnimationFrame"]||window[e[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,e){var n=Date.now(),a=Math.max(0,16-(n-i)),s=window.setTimeout(function(){t(n+a)},a);return i=n+a,s}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)});var a,s,h,l,o,r,u,c,m,f,g,d,v,w,p="mouseOver",M="mouseOut",x="mouseUp",E="mouseDown",N="click",C="function",T="canvas",A="2d",y="image/png",D="Anonymous",I="play",R="playFrom",L="playUntil",S="playBetween",b=function(t){var i,e,n=0,a=0,s=0,h=0,l=0,o=!1,r=t,u={};this.addEventListener=function(t,e,r){if(null!=t&&""!=t&&typeof e===C){null==(i=u[t])&&(i=u[t]=[]);for(var c=i.length,m=0;m<c;m++)if(e[1]==e&&e[0]==r)return;switch(u[t].push([r,e]),t){case N:n++;break;case p:a++;break;case M:s++;break;case E:h++;break;case x:l++}return o=n+a+s+h+l>0,!0}},this.removeEventListener=function(t,e,r){if(null!=t&&""!=t&&typeof e===C&&null!=(i=u[t]))for(var c=i.length,m=0;m<c;m++)if((e=i[m])[1]==e&&e[0]==r){switch(u[t].splice(m,1),t){case N:n--;break;case p:a--;break;case M:s--;break;case E:h--;break;case x:l--}return o=n+a+s+h+l>0,!0}},this.emit=function(t,n){if(null!=t&&""!=t&&null!=(i=u[t])){(n=null==n||"object"!=typeof n?{}:n).type=t,n.target=r;for(var a=i.length,s=0;s<a;s++)(e=i[s])[1].apply(e[0],[n])}},this.hasMouse=function(){return o}},Y=function(t,i,e,n,a,s,h){var l,o,r,u,c,m,f,g,d,v,w,p,M,x,E,N,C,T,A,y,D,I,R,L;return n-i,a-e,C=(f=n*(c=Math.cos(t)))-(g=a*(m=Math.sin(t)))+i,T=(d=n*m)+(v=a*c)+e,A=(M=(w=n+s)*c)-g+i,y=(x=w*m)+v+e,D=M-(E=(p=a+h)*m)+i,I=x+(N=p*c)+e,R=f-E+i,L=d+N+e,{minX:l=Math.min(Math.min(C,A),Math.min(D,R)),minY:o=Math.min(Math.min(T,y),Math.min(I,L)),maxX:r=Math.max(Math.max(C,A),Math.max(D,R)),maxY:u=Math.max(Math.max(T,y),Math.max(I,L)),width:Math.abs(r-l),height:Math.abs(u-o)}},B=0,F={},_={},O=function(t){var i=this;this.TEXT_SET="textSet",this.IMAGE_SET="imageSet",this.IMAGE_LOADED="imageLoaded",this.IMAGE_ERROR="imageError",this.CLIP_ADDED="clipAdded",this.CLIP_REMOVED="clipRemoved",this.CYCLE_END="cycleEnd",this.CYCLE_START="cycleStart",this.RENDER="render",this.START="start",this.END="end",this.CENTER="center",this.LEFT="left",this.RIGHT="right",this.TOP="top",this.BOTTOM="bottom",this.MIDDLE="middle";var e="clip"+ ++B;_[e]=this,this.name=e,this.x=0,this.y=0,this.width=0,this.height=0,this.alpha=1,this.scaleX=1,this.scaleY=1,this.rotation=0,this.pivotX=0,this.pivotY=0,this.visible=!0,this.isLoop=!1,this.background=null,this.text,this.interline=1.313,this.fontSize=12,this.font="sans-serif",this.textAlign=this.START,this.textBaseline="top",this.fontColor="black";var n,s,h,l,o,r,u,c,m,f,g,d,v,w,p,M,x,E,N,C,k,X,z,P,q,G,U,W,H,V,j,J,K,Q,Z,$,tt,it="auto",et=0,nt=0,at=60,st=1,ht=0,lt=0,ot=0,rt=0,ut=new b(this),ct=document.createElement(T),mt=ct.getContext(A),ft=[],gt=[],dt=null,vt=null,wt=!1;this.setPosition=function(t,i){!(null==t||isNaN(t))&&(this.x=t),!(null==i||isNaN(i))&&(this.y=i)},this.setSize=function(t,i){var e=null==t||isNaN(t)&&t!=it,n=null==i||isNaN(i)&&i!=it;e||n||t==it&&i==it||(null==dt&&null==vt||(t==it&&(t=i/vt*dt),i==it&&(i=t/dt*vt)),this.width=t,this.height=i)},this.setScale=function(t,i){!(null==t||isNaN(t))&&(this.scaleX=t),!(null==i||isNaN(i))&&(this.scaleY=i)},this.setPivot=function(t,i){!(null==t||isNaN(t))&&(this.pivotX=t),!(null==i||isNaN(i))&&(this.pivotY=i)},this.fitInto=function(t,i,e,n){if(null!=t&&null!=i&&!isNaN(t)&&!isNaN(i)){(null==e||isNaN(e))&&(e=0),(null==n||isNaN(n))&&(n=0);var a=Math.min(t/dt,i/vt),s=dt*a,h=vt*a;this.setSize(Math.floor(s),it);var l=Math.floor((t-s)/2),o=Math.floor((i-h)/2);this.x=l+this.pivotX*s+e,this.y=o+this.pivotY*h+n}},this.setAutoWidth=function(){this.setSize(it,this.height)},this.setAutoHeight=function(){this.setSize(this.width,it)},this.crop=function(t,e,a,s,h,l){t=null==t?ht:t,e=null==e?lt:e,a=null==a?ot:a,s=null==s?rt:s;i.width=null,i.height=null,ot=null,rt=null;var o=document.createElement(T);o.width=a,o.height=s,h=null==h||isNaN(h)?a:h,l=null==l||isNaN(l)?s:l,o.getContext(A).drawImage(n,t,e,a,s,0,0,h,l);var r=document.createElement("img");r.crossOrigin=D,r.src=o.toDataURL(y),this.setImage(o),this.setSize(h,l)},this.setImage=function(t){null!=t&&((n=t).crossOrigin=D,dt=t.width,vt=t.height,this.width=null==this.width||0==this.width?dt:this.width,this.height=null==this.height||0==this.height?vt:this.height,(s=document.createElement(T)).width=this.width,s.height=this.height,(h=s.getContext(A)).drawImage(t,0,0,dt,vt),this.setSize(this.width,this.height),ot=null==ot||0==ot?dt:ot,rt=null==rt||0==rt?vt:rt,this.setCycle(ht,lt,ot,rt),xt(i.IMAGE_SET,{image:t}))},this.setImageById=function(t){var i=document.getElementById(t);if(i.crossOrigin=D,null==i)throw"There is no element with the id: "+t;return setImage(i),i},this.loadImage=function(t,e){var n=new Image;n.onload=function(){i.setImage(n),xt(i.IMAGE_LOADED,{image:n,src:t})},n.onerror=function(e){xt(i.IMAGE_ERROR,{src:t})};var a=e?"?"+(new Date).getTime():"";n.crossOrigin=D,n.src=t+a},this.setMask=function(){wt=!0},this.unsetMask=function(){wt=!1},this.setBackground=function(t){this.background=t},this.setRect=function(t,e,n){if(null!=t&&null!=e&&!isNaN(t)&&!isNaN(e)){i.width=null,i.height=null,ot=null,rt=null;var a=document.createElement(T);a.width=t,a.height=e;var s=a.getContext(A);s.fillStyle=n,s.fillRect(0,0,t,e);var h=document.createElement("img");h.crossOrigin=D,h.src=a.toDataURL(y),this.setImage(a)}},this.setText=function(t,e,n,a){this.text=t,this.fontSize=null==e?this.fontSize:12,this.font=null==n?this.font:n,this.fontColor=null==a?this.fontColor:a,xt(i.TEXT_SET,{text:this.text})},this.getId=function(){return e},this.getNewClip=function(t){return new O(t)},this.addNewClip=function(t){var i=new O(t);return this.addClip(i),i},this.getClipAt=function(t){return ft[t]},this.addClip=function(t){null!=t&&t!=this&&this.addClipAt(t,ft.length)},this.addClipAt=function(t,e){if(null!=t&&t!=this&&!isNaN(e)){var n=t.getParent();null!=n&&n.removeClip(t),ft.splice(e,0,t),F[t.getId()]=this,xt(i.CLIP_ADDED,{parent:n})}},this.removeClip=function(t){if(null!=t&&t!=this)for(var i=ft.length,e=0;e<i;e++)if(ft[e]==t)return this.removeClipAt(e)},this.removeClipAt=function(t){if(!isNaN(t||t<0||!(t<ft.length))){var e=ft.splice(t,1)[0],n=F[e.getId()];return F[e.getId()]=null,xt(i.CLIP_REMOVED,{parent:n}),e}},this.removeAllClips=function(){for(;ft.length>0;)this.removeClipAt(0)},this.getTotalClip=function(){return ft.length},this.setDepth=function(t,i){if(null!=t&&t!=this&&!isNaN(i)){i=Math.max(i,0);for(var e=ft.length,n=0;n<e;n++)ft[n]==t&&ft.splice(i,0,ft.splice(n,1)[0])}},this.swapClips=function(t,i){if(null!=t&&null!=i){for(var e,n,a,s=ft.length;--s>-1;)t==(a=ft[s])&&(e=s),i==a&&(n=s);if(null!=e&&null!=n){var h=ft[e],l=ft[n];ft[e]=l,ft[n]=h}}},this.toFront=function(t){null!=t&&this.setDepth(t,ft.length-1)},this.toBack=function(t){null!=t&&this.setDepth(t,0)},this.getParent=function(){return F[e]},this.getClipByProp=function(t,i){return getClipListByProp(t,i)[0]},this.getClipListByProp=function(t,i){for(var e=ft.length,n=[],a=0;a<e;a++){var s;(s=ft[a])[t]==i&&n.push[s]}return n},this.setCycle=function(t,i,e,a,l,o,r){if(d=ht=null==t||isNaN(t)?ht:t,v=lt=null==i||isNaN(i)?lt:i,w=ot=null==e||isNaN(e)?ot:e,p=rt=null==a||isNaN(a)?rt:a,o=null==o||isNaN(o)?0:o,r=null==r||isNaN(r)?0:r,null==l||isNaN(l)){var u=Math.floor(n.width/w),c=Math.floor(n.height/p);l=st=u*c}var m;for(0==st&&(st=1),(s=document.createElement(T)).width=w*st,s.height=p,h=s.getContext(A),gt.length=0,M=0;M<st;M++)if(m=w*M,gt.push({x:m,y:0,width:w,height:p}),h.drawImage(n,d,v,w,p,m,0,w,p),(d+=w)>=dt&&(d=0,v+=p,lt>vt))throw new Error("The total frames is out of bound");1<st&&this.setSize(w,it)};var pt=function(t){et=nt>=t?-1:1,c=t},Mt=function(t){if(isNaN(t))throw new Error("The frame must be an integer and is: "+t);return x=(x=(x=t-1)<0?0:x)>=gt.length?gt.length-1:x};this.play=function(){var t=m;f=Date.now(),x=gt.length-1,g=I,u=0,pt(x),xt(i.CYCLE_START,{frame:t,action:g})},this.playFrom=function(t){var e=m;f=Date.now(),x=Mt(t),m=x+1,nt=x,u=x,g=R,pt(gt.length-1),xt(i.CYCLE_START,{frame:e,action:g})},this.playUntil=function(t){var e=m;f=Date.now(),x=Mt(t),u=nt,g=L,pt(x),xt(i.CYCLE_START,{frame:e,action:g})},this.playBetween=function(t,e){var n=m;f=Date.now(),E=Mt(t),N=Mt(e),nt=E,u=E,m=E+1,g=S,pt(N),xt(i.CYCLE_START,{frame:n,action:g})},this.stop=function(){var t=m;f=Date.now(),m=(x=nt)+1,c=x,g="stop",m=null,g=null,xt(i.CYCLE_START,{frame:t,action:g})},this.stopAt=function(t){var e=m;f=Date.now(),x=Mt(t),m=x+1,nt=Math.max(Math.min(x,gt.length),0),c=x,g="stopAt",m=null,g=null,xt(i.CYCLE_START,{frame:e,action:g})},this.nextFrame=function(){if(nt>=gt.length-1){if(!this.isLoop)return;nt=0}var t=m;f=Date.now(),x=Math.max(Math.min(nt+1,gt.length),0),m=x+1,nt=x,c=x,g="nextFrame",xt(i.CYCLE_START,{frame:t,action:g})},this.prevFrame=function(){if(0==nt){if(!this.isLoop)return;nt=gt.length-1}var t=m;f=Date.now(),x=Math.max(Math.min(nt-1,gt.length),0),m=x+1,nt=x,c=x,g="prevFrame",xt(i.CYCLE_START,{frame:t,action:g})},this.getTotalFrames=function(){return st},this.getCurrentFrame=function(){return m},this.setFrameRate=function(t){null==t||isNaN(t)||(at=t)},this.getFrameRate=function(){return at},this.emitMouseEvent=function(t,e,n){a==this&&xt(t,{x:e-i.x,y:n-i.y})},this.hasMouse=function(){return r},this.addEventListener=function(t,i,e){ut.addEventListener(t,i,e),r=ut.hasMouse()},this.removeEventListener=function(t,i,e){ut.removeEventListener(t,i,e),r=ut.hasMouse()},this.hasButton=function(){return _hasButton},this.debug=function(){};var xt=function(t,i){ut.emit(t,i)},Et=function(t,i,e){if(t.length>i){var n=t.slice(0,i).lastIndexOf(" "),a=t.slice(0,i).lastIndexOf("-");if((l=Math.max(n,a))>0){var s=t.slice(0,l+(a==l?1:0)),h=t.slice(l+1);return mt.fillText(s,0,e),void Et(h,i,e+=o)}var l;n=t.indexOf("-"),a=t.indexOf(" ");if((l=-1==n||-1==a?Math.max(n,a):Math.min(n,a))>0){s=t.slice(0,l+(a==l?0:1)),h=t.slice(l+1);return mt.fillText(s,0,e),void Et(h,i,e+=o)}}return mt.fillText(t,0,e),t};this.render=function(t,e,n,a){if(0==ft.length&&null==s||0==this.visible)return{};k=gt[C=nt];try{ht=k.x,lt=k.y,ot=k.width,rt=k.height}catch(t){this.name}if(m=C+1,(X=Date.now())-f>=1e3/at)if(f=X,nt!=c)nt+=et,nt=Math.max(0,nt);else if(0!=et){if(this.isLoop)switch(g){case S:case L:case R:nt=u;break;case I:nt=0}else et=0;null!=g&&xt(i.CYCLE_END,{frame:m,action:g})}var h,d,v,w,p;z=this.x,P=this.y,Z=this.scaleX,$=this.scaleY,q=this.width*Z,G=this.height*$,j=this.pivotX*q*Z,J=this.pivotY*G*$,U=ht,W=lt,H=ot,V=rt,Q=this.rotation*Math.PI/180;var M,x,E,N=[];h=null,d=null,v=null,w=null,null!=s&&(h=(p=Y(0,z,P,-j,-J,q,G)).minX,d=p.minY,v=p.maxX,w=p.maxY),null!=s?(M=q/dt,x=G/vt,M=isNaN(M)?1:M,x=isNaN(x)?1:x):(M=1,x=1),M*=Z,x*=$,l=null;var T=z-j,A=P-J,y=ft.length;for(C=0;C<y;C++)K=ft[C],tt=K.render(t,e,n-i.x,a-i.y,!1),null!=tt.inner&&(E=tt.bounds,N.push({canvas:tt.inner,x:E.minX,y:E.minY}),Boolean(tt.clipMouse)&&(l=tt.clipMouse),null!=h?(h=Math.min((E.minX+T)*M,h),d=Math.min((E.minY+A)*x,d),v=Math.max((E.maxX+T)*M,v),w=Math.max((E.maxY+A)*x,w)):(h=(E.minX+T)*M,d=(E.minY+A)*x,v=(E.maxX+T)*M,w=(E.maxY+A)*x));var D=Math.abs(v-h),b=Math.abs(w-d);h=(p=Y(Q,z,P,-(z-h),-(P-d),D,b)).minX,d=p.minY,v=p.maxX,w=p.maxY,ct.width=p.width,ct.height=p.height,mt.save(),mt.globalAlpha=i.alpha;var B,F,_,O,it,st,ut=Z<0?-ct.width:0,pt=$<0?-ct.height:0,Mt=.5+z-h+ut<<0,Nt=.5+P-d+pt<<0;if(mt.translate(Mt,Nt),mt.rotate(Q),Z=Z<0?-1:1,$=$<0?-1:1,mt.scale(Z,$),null!=i.background&&(mt.fillStyle=i.background,mt.fillRect(0,0,ct.width,ct.height)),null!=s?(U=.5+U<<0,W=.5+W<<0,H=.5+H<<0,V=.5+V<<0,j=.5+j<<0,J=.5+J<<0,q=.5+q<<0,G=.5+G<<0,mt.drawImage(s,U,W,H,V,-j,-J,q,G)):(i.width=D,i.height=b,dt=D,vt=b,H=D,V=b),null!=i.text){mt.textAlign=i.textAlign,mt.textBaseline=i.textBaseline,mt.fillStyle=i.fontColor,mt.font=i.fontSize+"px "+i.font;for(var Ct=i.width,Tt=0,At="M";Tt<Ct;)Tt=Math.round(mt.measureText(At).width),At+="M";o=i.interline*i.fontSize,Et(i.text,Math.max(At.length,1),0)}wt&&(mt.globalCompositeOperation="source-in");y=N.length;for(var yt=0;yt<y;yt++)null!=(st=N[yt])&&(B=st.canvas,F=.5+(st.x-j)*M<<0,_=.5+(st.y-J)*x<<0,O=.5+B.width*M<<0,it=.5+B.height*x<<0,mt.drawImage(st.canvas,F,_,O,it));if(mt.globalCompositeOperation="source-over",r){var Dt=mt.getImageData(n-h,a-d,1,1).data;Dt[3]>0&&(l=i)}mt.restore(),ct.id=i.name;var It={inner:ct,clipMouse:l,bounds:p,x:h,y:d};return xt(i.RENDER,{}),i.debug(ct,i.name),It},this.setImage(t)},k=t,X=k.getContext(A),z=function(){},P=function(){void 0!=h&&void 0!=l&&(g="default",Boolean(m)&&m.hasMouse()?(g="pointer",m!=c&&(q(),c=m,a=m,m.emitMouseEvent(p),a=null)):q(),k.style.cursor=g)},q=function(t){Boolean(c)&&c.hasMouse()&&(a=c,c.emitMouseEvent(M,h,l),t&&c.emitMouseEvent(x,h,l),c=null,m=null,a=null)},G=function(){m=null,k.width=f.width,k.height=f.height,s.width=f.width,s.height=f.height,v=f.render(k.width,k.height,h,l),d=v.inner,Boolean(d)&&(X.drawImage(d,v.x,v.y),null!=(w=v.clipMouse)&&(m=w)),z(),requestAnimationFrame(G)};return function(){k.width=k.width,k.height=k.height,s=k.cloneNode(),s.getContext(A),s.width=k.width,s.height=k.height,(f=new O).name="canvateStage",f.setImage(k),k.onmousemove=function(t){t.preventDefault(),u=k.getBoundingClientRect(),o=t.clientX,r=t.clientY,h=(o-u.left)*(k.width/u.width),l=(r-u.top)*(k.width/u.width),z=P},k.onclick=function(t){t.preventDefault(),Boolean(m)&&m.hasMouse()&&(a=m,m.emitMouseEvent(N,h,l),a=null)},k.onmousedown=function(t){t.preventDefault(),Boolean(m)&&m.hasMouse()&&(a=m,m.emitMouseEvent(E,h,l),a=null)},k.onmouseup=function(t){t.preventDefault(),Boolean(m)&&m.hasMouse()&&(a=m,m.emitMouseEvent(x,h,l),a=null)},window.onmouseleave=function(t){console.log("WINDOW LEFT!!")},document.onmouseleave=k.onmouseleave=function(t){q(!0),z=function(){}};new b(k);G()}(),f};