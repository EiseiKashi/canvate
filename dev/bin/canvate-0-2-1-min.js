window.Canvate=function(t){"use strict";if("string"==typeof t&&null==(t=document.getElementById(t)))throw"There is no element with the 'id': "+t;window.check=!0;for(var i=0,e=["ms","moz","webkit","o"],n=0;n<e.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[e[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[n]+"CancelAnimationFrame"]||window[e[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(t,e){var n=Date.now(),s=Math.max(0,16-(n-i)),h=window.setTimeout(function(){t(n+s)},s);return i=n+s,h}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)});var s,h,l,a,o,r,u,c,f,m,g,d,v,w,p="mouseOver",x="mouseOut",N="mouseUp",M="mouseDown",C="mouseLeave",E="click",A="function",y="canvas",T="2d",I="image/png",D="Anonymous",L="play",b="playFrom",B="playUntil",R="playBetween",S=["text","size","font","color","interline","textAlign","textBaseline","width","height","isWordWrap"],Y=0,k={},_={},F=t,z=F.getContext(T),W=function(){},X=function(t){var i,e,n=0,s=0,h=0,l=0,a=0,o=0,r=!1,u=t,c={};this.addEventListener=function(t,e,u){if(null!=t&&""!=t&&typeof e===A){null==(i=c[t])&&(i=c[t]=[]);for(var f=i.length,m=0;m<f;m++)if(e[1]==e&&e[0]==u)return;switch(c[t].push([u,e]),t){case E:n++;break;case p:s++;break;case x:h++;break;case M:l++;break;case N:a++;break;case C:o++}return r=n+s+h+l+a+o>0,!0}},this.removeEventListener=function(t,e,u){if(null!=t&&""!=t&&typeof e===A&&null!=(i=c[t]))for(var f=i.length,m=0;m<f;m++)if((e=i[m])[1]==e&&e[0]==u){switch(c[t].splice(m,1),t){case E:n--;break;case p:s--;break;case x:h--;break;case M:l--;break;case N:a--;break;case C:o--}return r=n+s+h+l+a+o>0,!0}},this.emit=function(t,n){if(null!=t&&""!=t&&null!=(i=c[t])){(n=null==n||"object"!=typeof n?{}:n).type=t,n.target=u;for(var s=i.length,h=0;h<s;h++)(e=i[h])[1].apply(e[0],[n])}},this.hasMouse=function(){return r}},O=function(t,i,e,n,s,h,l){var a,o,r,u,c,f,m,g,d,v,w,p,x,N,M,C,E,A,y,T,I,D,L,b;return n-i,s-e,E=(m=n*(c=Math.cos(t)))-(g=s*(f=Math.sin(t)))+i,A=(d=n*f)+(v=s*c)+e,y=(x=(w=n+h)*c)-g+i,T=(N=w*f)+v+e,I=x-(M=(p=s+l)*f)+i,D=N+(C=p*c)+e,L=m-M+i,b=d+C+e,{minX:a=Math.min(Math.min(E,y),Math.min(I,L)),minY:o=Math.min(Math.min(A,T),Math.min(D,b)),maxX:r=Math.max(Math.max(E,y),Math.max(I,L)),maxY:u=Math.max(Math.max(A,T),Math.max(D,b)),width:Math.abs(r-a),height:Math.abs(u-o)}},P=function(t){var i=this;this.TEXT_SET="textSet",this.IMAGE_SET="imageSet",this.IMAGE_LOADED="imageLoaded",this.IMAGE_ERROR="imageError",this.CLIP_ADDED="clipAdded",this.CLIP_REMOVED="clipRemoved",this.CYCLE_END="cycleEnd",this.CYCLE_START="cycleStart",this.RENDER="render";var e="clip"+ ++Y;_[e]=this,this.name=e,this.x=0,this.y=0,this.width=null,this.height=null,this.alpha=1,this.scaleX=1,this.scaleY=1,this.rotation=0,this.pivotX=0,this.pivotY=0,this.visible=!0,this.isLoop=!1,this.background=null,this.isWordWrap=!0,this.text,this.font,this.fontSize,this.fontColor,this.interline,this.textAlign,this.textBaseline,this.bounds;var n,h,l,a,o,r,u,c,f,m,g,d,v,w,p,x,C,E,A,F,z,W,H,q,G,U,V,j,J,K,Q,Z,$,tt,it,et,nt,st,ht="auto",lt=0,at=0,ot=60,rt=1,ut=0,ct=0,ft=0,mt=0,gt=new X(this),dt=document.createElement(y),vt=dt.getContext(T),wt=[],pt=[],xt=null,Nt=null,Mt=!1;this.setPosition=function(t,i){!(null==t||isNaN(t))&&(this.x=t),!(null==i||isNaN(i))&&(this.y=i)},this.setSize=function(t,i){var e=null==t||isNaN(t)&&t!=ht,n=null==i||isNaN(i)&&i!=ht;e||n||t==ht&&i==ht||(null==xt&&null==Nt||(t==ht&&(t=i/Nt*xt),i==ht&&(i=t/xt*Nt)),this.width=t,this.height=i)},this.setScale=function(t,i){!(null==t||isNaN(t))&&(this.scaleX=t),!(null==i||isNaN(i))&&(this.scaleY=i)},this.setPivot=function(t,i){!(null==t||isNaN(t))&&(this.pivotX=t),!(null==i||isNaN(i))&&(this.pivotY=i)},this.fitInto=function(t,i,e,n){if(null!=t&&null!=i&&!isNaN(t)&&!isNaN(i)){(null==e||isNaN(e))&&(e=0),(null==n||isNaN(n))&&(n=0);var s=Math.min(t/xt,i/Nt),h=xt*s,l=Nt*s;this.setSize(Math.floor(h),ht);var a=Math.floor((t-h)/2),o=Math.floor((i-l)/2);this.x=a+this.pivotX*h+e,this.y=o+this.pivotY*l+n}},this.setAutoWidth=function(){this.setSize(ht,this.height)},this.setAutoHeight=function(){this.setSize(this.width,ht)},this.crop=function(t,e,s,h,l,a){t=null==t?ut:t,e=null==e?ct:e,s=null==s?ft:s,h=null==h?mt:h;i.width=null,i.height=null,ft=null,mt=null;var o=document.createElement(y);o.width=s,o.height=h,l=null==l||isNaN(l)?s:l,a=null==a||isNaN(a)?h:a,o.getContext(T).drawImage(n,t,e,s,h,0,0,l,a);var r=document.createElement("img");r.crossOrigin=D,r.src=o.toDataURL(I),this.setImage(o),this.setSize(l,a)},this.setImage=function(t){null!=t&&((n=t).crossOrigin=D,xt=t.naturalWidth,Nt=t.naturalHeight,xt=null==xt?t.width:xt,Nt=null==Nt?t.height:Nt,this.width=null==this.width||0==this.width?xt:this.width,this.height=null==this.height||0==this.height?Nt:this.height,this.setSize(this.width,this.height),g=null,ft=null==ft||0==ft?xt:ft,mt=null==mt||0==mt?Nt:mt,this.setCycle(ut,ct,ft,mt),Lt(i.IMAGE_SET,{image:t}))},this.setCycle=function(t,i,e,s,h,l,a){if(v=ut=null==t||isNaN(t)?ut:t,w=ct=null==i||isNaN(i)?ct:i,p=ft=null==e||isNaN(e)?ft:e,x=mt=null==s||isNaN(s)?mt:s,l=null==l||isNaN(l)?0:l,a=null==a||isNaN(a)?0:a,null==h||isNaN(h)){var o=Math.floor(n.width/p),r=Math.floor(n.height/x);h=rt=o*r}for(0==rt&&(rt=1),pt.length=0,C=0;C<rt;C++)if(p*C,pt.push({x:v,y:w,width:p,height:x}),(v+=p)>=xt&&(v=0,w+=x,ct>Nt))throw new Error("The total frames is out of bound");1<rt&&this.setSize(p,ht)},this.setImageById=function(t){var i=document.getElementById(t);if(i.crossOrigin=D,null==i)throw"There is no element with the id: "+t;return this.setImage(i),i},this.loadImage=function(t,e){var n=new Image;n.onload=function(){i.setImage(n),Lt(i.IMAGE_LOADED,{image:n,src:t})},n.onerror=function(e){Lt(i.IMAGE_ERROR,{src:t})};var s=e?"?"+(new Date).getTime():"";n.crossOrigin=D,n.src=t+s},this.setMask=function(){Mt=!0},this.unsetMask=function(){Mt=!1},this.setBackground=function(t){this.background=t},this.setRect=function(t,e,n){if(null!=t&&null!=e&&!isNaN(t)&&!isNaN(e)){i.width=null,i.height=null,ft=null,mt=null;var s=document.createElement(y);s.width=t,s.height=e;var h=s.getContext(T);h.fillStyle=n,h.fillRect(0,0,t,e);var l=document.createElement("img");l.crossOrigin=D,l.src=s.toDataURL(I),this.setImage(s)}},this.setText=function(t,i,e,n,s,h,l,a,o){var r=new function(t,i,e,n,s,h,l,a,o){var r=this;this.text=t,this.size=null==i||isNaN(i)?12:i,this.font=null==e?"sans-serif":e,this.color=null==n?"black":n,this.width=null==s||isNaN(s)?null:s,this.height=null==h||isNaN(h)?null:h,this.interline=null==l||isNaN(l)?1.313:l,this.textAlign=null==a?"start":a,this.textBaseline=null==o?"top":o,this.isWordWrap=!0,this.naturalWidth,this.naturalHeight;var u,c,f,m,g,d,v,w,p,x,N=document.createElement(y),M=N.getContext(T),C=!1,E=[],A=[];this.getCanvas=function(){var t=!0,i=S.length;for(a=0;a<i;a++)m=r[S[a]],E[a]!=m&&(t=!1),E[a]=m;if(t&&C)return N;M.textAlign=r.textAlign,M.textBaseline=r.textBaseline,M.fillStyle=r.color,M.font=r.size+"px "+r.font;var e=r.text;if(p=null==this.width?Math.ceil(M.measureText(e).width):this.width,x=null==this.height?r.interline*r.size:this.height,this.isWordWrap){f=r.interline*r.size,A.length=0;var n=0,s=Math.ceil(M.measureText(e).width);c=s;for(var h=!1;s>p&&(h||(h=!0,c=0),g=e.indexOf("-"),d=e.indexOf(" "),g>0||d>0);)v=-1==g?d:-1==d?g:Mat.min(g,d),l=e.slice(0,v+(d==v?1:0)),w=e.slice(v+1),A.push(l),n+=f,s=Math.ceil(M.measureText(w).width),c=Math.max(Math.ceil(M.measureText(l).width),c),e=w;A.push(e)}u=n+f,N.width=this.naturalWidth=p,N.height=this.naturalHeight=x,M.textAlign=r.textAlign,M.textBaseline=r.textBaseline,M.fillStyle=r.color,M.font=r.size+"px "+r.font,i=A.length,n=0;for(var l,a=0;a<i;a++)l=A[a],M.fillText(l,0,n),n+=f;return C=t,N},this.getHeight=function(){return null==u&&this.getCanvas(),u},this.getWidth=function(){return null==u&&this.getCanvas(),c}}(t,i=null==i?this.fontSize:i,e=null==e?this.font:e,n=null==n?this.fontColor:n,s=null==s?this.width:s,h=null==h?this.height:h,l=null==l?this.interline:l,a=null==a?this.textAlign:a,o=null==o?this.textBaseline:o);this.setImage(r.getCanvas()),this.text=r.text,this.fontSize=r.size,this.font=r.font,this.fontColor=r.color,this.interline=r.interline,this.textAlign=r.textAlign,this.textBaseline=r.textBaseline,g=r},this.textToImage=function(){if(null==g)return null;d=!0},this.getTextWidth=function(){return null==g?null:g.getWidth()},this.getTextHeight=function(){return null==g?null:g.getHeight()},this.fitToText=function(){null!=g&&(g.width=this.width,g.height=this.height,g.getCanvas(),this.width=g.getWidth(),this.height=g.getHeight())},this.getId=function(){return e},this.getNewClip=function(t){return new P(t)},this.addNewClip=function(t){var i=new P(t);return this.addClip(i),i},this.getClipAt=function(t){return wt[t]},this.addClip=function(t){null!=t&&t!=this&&this.addClipAt(t,wt.length)},this.addClipAt=function(t,e){if(null!=t&&t!=this&&!isNaN(e)){var n=t.getParent();null!=n&&n.removeClip(t),wt.splice(e,0,t),k[t.getId()]=this,Lt(i.CLIP_ADDED,{parent:n})}},this.removeClip=function(t){if(null!=t&&t!=this)for(var i=wt.length,e=0;e<i;e++)if(wt[e]==t)return this.removeClipAt(e)},this.removeClipAt=function(t){if(!isNaN(t||t<0||!(t<wt.length))){var e=wt.splice(t,1)[0],n=k[e.getId()];return k[e.getId()]=null,Lt(i.CLIP_REMOVED,{parent:n}),e}},this.removeAllClips=function(){for(;wt.length>0;)this.removeClipAt(0)},this.getTotalClip=function(){return wt.length},this.setDepth=function(t,i){if(null!=t&&t!=this&&!isNaN(i)){i=Math.max(i,0);for(var e=wt.length,n=0;n<e;n++)wt[n]==t&&wt.splice(i,0,wt.splice(n,1)[0])}},this.swapClips=function(t,i){if(null!=t&&null!=i){for(var e,n,s,h=wt.length;--h>-1;)t==(s=wt[h])&&(e=h),i==s&&(n=h);if(null!=e&&null!=n){var l=wt[e],a=wt[n];wt[e]=a,wt[n]=l}}},this.toFront=function(t){null!=t&&this.setDepth(t,wt.length-1)},this.toBack=function(t){null!=t&&this.setDepth(t,0)},this.getParent=function(){return k[e]},this.getClipByProp=function(t,i){return getClipListByProp(t,i)[0]},this.getClipListByProp=function(t,i){for(var e=wt.length,n=[],s=0;s<e;s++){var h;(h=wt[s])[t]==i&&n.push[h]}return n};var Ct,Et,At=function(t){lt=at>=t?-1:1,u=t},yt=function(t){if(isNaN(t))throw new Error("The frame must be an integer and is: "+t);return E=(E=(E=t-1)<0?0:E)>=pt.length?pt.length-1:E};this.play=function(){var t=c;f=Date.now(),E=pt.length-1,m=L,r=0,At(E),Lt(i.CYCLE_START,{frame:t,action:m})},this.playFrom=function(t){var e=c;f=Date.now(),E=yt(t),c=E+1,at=E,r=E,m=b,At(pt.length-1),Lt(i.CYCLE_START,{frame:e,action:m})},this.playUntil=function(t){var e=c;f=Date.now(),E=yt(t),r=at,m=B,At(E),Lt(i.CYCLE_START,{frame:e,action:m})},this.playBetween=function(t,e){var n=c;f=Date.now(),A=yt(t),F=yt(e),at=A,r=A,c=A+1,m=R,At(F),Lt(i.CYCLE_START,{frame:n,action:m})},this.stop=function(){var t=c;f=Date.now(),c=(E=at)+1,u=E,m="stop",c=null,m=null,Lt(i.CYCLE_START,{frame:t,action:m})},this.stopAt=function(t){var e=c;f=Date.now(),E=yt(t),c=E+1,at=Math.max(Math.min(E,pt.length),0),u=E,m="stopAt",c=null,m=null,Lt(i.CYCLE_START,{frame:e,action:m})},this.nextFrame=function(){if(at>=pt.length-1){if(!this.isLoop)return;at=0}var t=c;f=Date.now(),E=Math.max(Math.min(at+1,pt.length),0),c=E+1,at=E,u=E,m="nextFrame",Lt(i.CYCLE_START,{frame:t,action:m})},this.prevFrame=function(){if(0==at){if(!this.isLoop)return;at=pt.length-1}var t=c;f=Date.now(),E=Math.max(Math.min(at-1,pt.length),0),c=E+1,at=E,u=E,m="prevFrame",Lt(i.CYCLE_START,{frame:t,action:m})},this.getTotalFrames=function(){return rt},this.getCurrentFrame=function(){return c},this.setFrameRate=function(t){null==t||isNaN(t)||(ot=t)},this.getFrameRate=function(){return ot};var Tt=!1,It=function(t){Tt=!0,Ct=h-i.x,Et=l-i.y},Dt=function(t){Tt=!1};this.activateDrag=function(){this.addEventListener(M,It),this.addEventListener(N,Dt)},this.deactiveteDrag=function(){Tt=!1,this.removeEventListener(M,It),this.removeEventListener(N,Dt)},this.emitMouseEvent=function(t,e,n){s==this&&Lt(t,{x:e-i.x,y:n-i.y})},this.hasMouse=function(){return o},this.addEventListener=function(t,i,e){gt.addEventListener(t,i,e),o=gt.hasMouse()},this.removeEventListener=function(t,i,e){gt.removeEventListener(t,i,e),o=gt.hasMouse()},this.hasButton=function(){return _hasButton},this.debug=function(){};var Lt=function(t,i){gt.emit(t,i)};this.render=function(t,e,s,v){if(h=s,l=v,0==wt.length&&null==n||0==this.visible)return{};W=pt[z=at];try{ut=W.x,ct=W.y,ft=W.width,mt=W.height}catch(t){this.name}if(c=z+1,(H=Date.now())-f>=1e3/ot)if(f=H,at!=u)at+=lt,at=Math.max(0,at);else if(0!=lt){if(this.isLoop)switch(m){case R:case B:case b:at=r;break;case L:at=0}else lt=0;null!=m&&Lt(i.CYCLE_END,{frame:c,action:m})}var w,p,x,N,M;null!=g&&(g.text=this.text,g.size=this.fontSize,g.font=this.font,g.color=this.fontColor,g.interline=this.interline,g.textAlign=this.textAlign,g.textBaseline=this.textBaseline,g.isWordWrap=this.isWordWrap,g.width=this.width,g.height=this.height,n=g.getCanvas(),xt=ft=this.width,Nt=mt=this.height),Tt&&(this.x=h-Ct,this.y=l-Et),q=this.x,G=this.y,et=this.scaleX,nt=this.scaleY,U=this.width*et,V=this.height*nt,Z=this.pivotX*U*et,$=this.pivotY*V*nt,j=ut,J=ct,K=ft,Q=mt,it=this.rotation*Math.PI/180;var C,E,A,y=[];w=null,p=null,x=null,N=null,null!=n&&(w=(M=O(0,q,G,-Z,-$,U,V)).minX,p=M.minY,x=M.maxX,N=M.maxY),null!=n?(C=U/xt,E=V/Nt,C=isNaN(C)?1:C,E=isNaN(E)?1:E):(C=1,E=1),C*=et,E*=nt,a=null;var T=q-Z,I=G-$,D=wt.length;for(z=0;z<D;z++)tt=wt[z],st=tt.render(t,e,s-i.x,v-i.y,!1),null!=st.inner&&(A=st.bounds,y.push({canvas:st.inner,x:A.minX,y:A.minY}),Boolean(st.clipMouse)&&(a=st.clipMouse),null!=w?(w=Math.min((A.minX+T)*C,w),p=Math.min((A.minY+I)*E,p),x=Math.max((A.maxX+T)*C,x),N=Math.max((A.maxY+I)*E,N)):(w=(A.minX+T)*C,p=(A.minY+I)*E,x=(A.maxX+T)*C,N=(A.maxY+I)*E));var S=Math.abs(x-w),Y=Math.abs(N-p);w=(M=O(it,q,G,-(q-w),-(G-p),S,Y)).minX,p=M.minY,x=M.maxX,N=M.maxY,dt.width=M.width,dt.height=M.height,vt.save(),vt.globalAlpha=i.alpha;var k,_,F,X,P,ht,rt=et<0?-dt.width:0,gt=nt<0?-dt.height:0,At=q-w+rt,yt=G-p+gt;vt.translate(At,yt),vt.rotate(it),et=et<0?-1:1,nt=nt<0?-1:1,vt.scale(et,nt),null!=i.background&&(vt.fillStyle=i.background,vt.fillRect(0,0,dt.width,dt.height)),null!=n?vt.drawImage(n,j,J,K,Q,-Z,-$,U,V):(i.width=S,i.height=Y,xt=S,Nt=Y,K=S,Q=Y),Mt&&(vt.globalCompositeOperation="source-in");D=y.length;for(var It=0;It<D;It++)null!=(ht=y[It])&&(k=ht.canvas,_=(ht.x-Z)*C,F=(ht.y-$)*E,X=k.width*C,P=k.height*E,vt.drawImage(ht.canvas,_,F,X,P));if(vt.globalCompositeOperation="source-over",o){var Dt=vt.getImageData(s-w,v-p,1,1).data;Dt[3]>0&&(a=i)}vt.restore(),dt.id=i.name;var bt={inner:dt,clipMouse:a,bounds:M,x:w,y:p};return Lt(i.RENDER,{}),d&&(d=!1,this.setImage(n)),this.bounds=M,bt},this.setImage(t)},H=function(){void 0!=l&&void 0!=a&&(g="default",Boolean(f)&&f.hasMouse()?(g="pointer",f!=c&&(q(),c=f,s=f,f.emitMouseEvent(p,l,a),s=null)):q(),F.style.cursor=g)},q=function(t){Boolean(c)&&c.hasMouse()&&(s=c,c.emitMouseEvent(x,l,a),t&&c.emitMouseEvent(N,l,a),c=null,f=null,s=null)},G=function(){f=null,F.width=m.width,F.height=m.height,h.width=m.width,h.height=m.height,v=m.render(F.width,F.height,l,a),d=v.inner,Boolean(d)&&(z.drawImage(d,v.x,v.y),null!=(w=v.clipMouse)&&(f=w)),W(),requestAnimationFrame(G)};return function(){F.width=F.width,F.height=F.height,h=F.cloneNode(),h.getContext(T),h.width=F.width,h.height=F.height,(m=new P).name="canvateStage",m.setImage(F),delete m.setImage,delete m.setText,delete m.setImageById,delete m.loadImage,F.onmousemove=function(t){t.preventDefault(),u=F.getBoundingClientRect(),o=t.clientX,r=t.clientY,l=(o-u.left)*(F.width/u.width),a=(r-u.top)*(F.width/u.width),W=H},F.onclick=function(t){t.preventDefault(),Boolean(f)&&f.hasMouse()&&(s=f,f.emitMouseEvent(E,l,a),s=null)},F.onmousedown=function(t){t.preventDefault(),Boolean(f)&&f.hasMouse()&&(s=f,f.emitMouseEvent(M,l,a),s=null)},F.onmouseup=function(t){t.preventDefault(),Boolean(f)&&f.hasMouse()&&(s=f,f.emitMouseEvent(N,l,a),s=null)},window.onmouseleave=function(t){q(!0)},document.onmouseleave=F.onmouseleave=function(t){q(!0),W=function(){}};new X(F);G()}(),m};